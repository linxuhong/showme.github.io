# 系统想着


    
     
### 负载均衡 

1.    OSPF DLVS DR

 

2. 用subline text打开 Demo.class 文件 内容 

 
  - cafe babe     字节码文件 标识 
  - 0000 0032     版本号 0000次版本号， 0032主版本号 （ 32相当于十进抽的 50）  ---jdk6 编译出来的 


### Nginx  

1.  常用配置参数   
    - include       mime.types;   #文件扩展名与文件类型映射表
    - default_type  application/octet-stream; #默认文件类型，默认为text/plain
    - access_log off; #取消服务日志   
    - log_format myFormat ' $remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; #自定义格式
    - access_log log/access.log myFormat;  #combined为日志格式的默认值
    - sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。
    - sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。
    - keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。
    - proxy_connect_timeout 1;   #nginx服务器与被代理的服务器建立连接的超时时间，默认60秒
    - proxy_read_timeout 1; #nginx服务器想被代理服务器组发出read请求后，等待响应的超时间，默认为60秒。
    - proxy_send_timeout 1; #nginx服务器想被代理服务器组发出write请求后，等待响应的超时间，默认为60秒。
    - proxy_http_version 1.0 ; #Nginx服务器提供代理服务的http协议版本1.0，1.1，默认设置为1.0版本。
      - proxy_method get;    #支持客户端的请求方法。post/get；
    - proxy_ignore_client_abort on;  #客户端断网时，nginx服务器是否终端对被代理服务器的请求。默认为off。
    - proxy_ignore_headers "Expires" "Set-Cookie";  #Nginx服务器不处理设置的http相应投中的头域，这里空格隔开可以设置多个。
    - proxy_intercept_errors on;    #如果被代理服务器返回的状态码为400或者大于400，设置的error_page配置起作用。默认为off。
    - proxy_headers_hash_max_size 1024; #存放http报文头的哈希表容量上限，默认为512个字符。
    - proxy_headers_hash_bucket_size 128; #nginx服务器申请存放http报文头的哈希表容量大小。默认为64个字符。
    - proxy_next_upstream timeout;  #反向代理upstream中设置的服务器组，出现故障时，被代理服务器返回的状态值。error|timeout|invalid_header|http_500|http_502|http_503|http_504|http_404|off
    - proxy_ssl_session_reuse on; 默认为on，如果我们在错误日志中发现“SSL3_GET_FINSHED:digest check failed”的情况时，可以将该指令设置为off。

2. 代理 
    
    ~~~ xml
    upstream mysvr { 
    server 192.168.10.121:3333; 
    server 192.168.10.122:3333; } 
    server { .... location ~*^.+$ { 
    proxy_pass http://mysvr; #请求转向mysvr 定义的服务器列表  } }
    ~~~
    
-  热备：如果你有2台服务器，当一台服务器发生事故时，才启用第二台服务器给提供服务。服务器处理请求的顺序：AAAAAA突然A挂啦，BBBBBBBBBBBBBB.....
    
            ~~~ xml
            upstream mysvr { 
                server 127.0.0.1:7878; 
                server 192.168.10.121:3333 backup; #热备  
            }
            ~~~
    
-  轮询：nginx默认就是轮询其权重都默认为1，服务器处理请求的顺序：ABABABABAB....
        ~~~ xml
            upstream mysvr {
                 server 127.0.0.1:7878; 
                server 192.168.10.121:3333; 
            }
        ~~~
- 加权轮询：跟据配置的权重的大小而分发给不同服务器不同数量的请求。如果不设置，则默认为1。下面服务器的请求顺序为：ABBABBABBABBABB....
        ~~~ xml
        upstream mysvr { 
           server 127.0.0.1:7878 weight=1; 
            server 192.168.10.121:3333 weight=2; 
        }
        ~~~
- ip_hash:nginx会让相同的客户端ip请求相同的服务器。
       ~~~ xml
        upstream mysvr {
          server 127.0.0.1:7878; 
         server 192.168.10.121:3333; ip_hash; 
        }
        ~~~
- 如果你对上面4种均衡算法不是很理解，可以查看Nginx 配置详解，可能会更加容易理解点。

    到这里你是不是感觉nginx的负载均衡配置特别简单与强大，那么还没完，咱们继续哈，这里扯下蛋。

    关于nginx负载均衡配置的几个状态参数讲解。
    down，表示当前的server暂时不参与负载均衡。
    backup，预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻。
    max_fails，允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误。
    fail_timeout，在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。
    ~~~ xml
    upstream mysvr { 
        server 127.0.0.1:7878 weight=2 max_fails=2 fail_timeout=2; 
        server 192.168.10.121:3333 weight=1 max_fails=2 fail_timeout=1; 
    }

   ~~~
 
 

  
  
  




  
  
# License

* [Wiki]()

[]:https://wwww.pigasuo.com





























